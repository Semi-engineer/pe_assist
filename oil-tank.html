<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Oil Tank Checker</title>
  <link rel="stylesheet" href="css/style.css" />
  <!-- Tailwind CDN (ถ้าอยากใช้สไตล์แบบ component ที่ทำไว้) -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-50">

  <header class="navbar bg-white shadow">
    <div class="container mx-auto p-4 flex justify-between items-center">
      <h1 class="text-xl font-bold">Oil Tank Checker</h1>
      <nav>
        <a href="index.html" class="text-sky-600">กลับหน้าแรก</a>
      </nav>
    </div>
  </header>

  <main class="container mx-auto p-4">
    <div id="oil-tank-app"></div>
  </main>

  <!-- React + Babel -->
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- ใส่โค้ด React App -->
  <script type="text/babel">
    // === โค้ดจาก OilTankChecker.jsx ===
    function OilTankChecker() {
      const [diameter, setDiameter] = React.useState(59);
      const [height, setHeight] = React.useState(89);
      const [mode, setMode] = React.useState("level");
      const [level, setLevel] = React.useState(35);
      const [volume, setVolume] = React.useState(95.69);

      const r = React.useMemo(() => diameter / 2, [diameter]);
      const area = React.useMemo(() => Math.PI * r * r, [r]);

      const cm3_to_liters = (v) => v / 1000;
      const liters_to_cm3 = (L) => L * 1000;

      const calcVolumeFromLevel = (h) => cm3_to_liters(area * h);
      const calcLevelFromVolume = (L) => liters_to_cm3(L) / area;

      const maxVolumeLiters = React.useMemo(() => cm3_to_liters(area * height), [area, height]);

      const displayed = React.useMemo(() => {
        if (mode === "level") {
          const vol = calcVolumeFromLevel(level);
          const pct = (level / height) * 100;
          return { volumeLiters: vol, percent: pct, levelCm: level };
        } else {
          const lvl = calcLevelFromVolume(volume);
          const pct = (lvl / height) * 100;
          return { volumeLiters: volume, percent: pct, levelCm: lvl };
        }
      }, [mode, level, volume, area, height]);

      const clampInputs = () => {
        if (diameter <= 0) setDiameter(1);
        if (height <= 0) setHeight(1);
        if (level < 0) setLevel(0);
        if (level > height) setLevel(height);
        if (volume < 0) setVolume(0);
        if (volume > maxVolumeLiters) setVolume(parseFloat(maxVolumeLiters.toFixed(2)));
      };

      const svgHeight = 300;
      const fillHeightPx = Math.max(0, Math.min(1, displayed.levelCm / height)) * svgHeight;

      return (
        <div className="bg-white rounded-2xl shadow-lg p-6 grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <h1 className="text-2xl font-semibold mb-2">Oil Tank Volume Checker</h1>
            <p className="text-sm text-slate-600 mb-4">
              คำนวณปริมาตรน้ำมันในถังทรงกระบอก — ป้อนค่าที่ต้องการแล้วกดคำนวณ
            </p>

            <div className="space-y-3">
              <label className="block text-sm font-medium">เส้นผ่านศูนย์กลาง (cm)</label>
              <input type="number" value={diameter} onChange={(e)=>setDiameter(parseFloat(e.target.value||0))} onBlur={clampInputs}
                className="w-full p-2 border rounded" />

              <label className="block text-sm font-medium">ความสูงถังทั้งหมด (cm)</label>
              <input type="number" value={height} onChange={(e)=>setHeight(parseFloat(e.target.value||0))} onBlur={clampInputs}
                className="w-full p-2 border rounded" />

              <div className="flex items-center gap-3">
                <label className="text-sm font-medium">โหมด</label>
                <div className="flex gap-2">
                  <button onClick={()=>setMode('level')} className={`px-3 py-1 rounded ${mode==='level'? 'bg-sky-600 text-white':'bg-slate-100'}`}>ป้อนระดับ (cm)</button>
                  <button onClick={()=>setMode('volume')} className={`px-3 py-1 rounded ${mode==='volume'? 'bg-sky-600 text-white':'bg-slate-100'}`}>ป้อนปริมาตร (L)</button>
                </div>
              </div>

              {mode === 'level' ? (
                <>
                  <label className="block text-sm font-medium">ระดับน้ำมัน (cm)</label>
                  <input type="number" value={level} onChange={(e)=>setLevel(parseFloat(e.target.value||0))} onBlur={clampInputs}
                    className="w-full p-2 border rounded" />
                  <div className="text-xs text-slate-500">หมายเหตุ: ค่า 0 ถึง {height} cm</div>
                </>
              ) : (
                <>
                  <label className="block text-sm font-medium">ปริมาตรน้ำมัน (ลิตร)</label>
                  <input type="number" value={volume} onChange={(e)=>setVolume(parseFloat(e.target.value||0))} onBlur={clampInputs}
                    className="w-full p-2 border rounded" />
                  <div className="text-xs text-slate-500">สูงสุดถังเต็ม ≈ {maxVolumeLiters.toFixed(2)} L</div>
                </>
              )}

              <div className="flex gap-2">
                <button onClick={clampInputs} className="px-4 py-2 bg-emerald-600 text-white rounded">คำนวณ</button>
                <button onClick={()=>{ setDiameter(59); setHeight(89); setLevel(35); setVolume(95.69); setMode('level'); }} className="px-4 py-2 bg-slate-200 rounded">รีเซ็ต</button>
              </div>
            </div>

            <div className="mt-5 p-4 bg-slate-50 rounded">
              <div className="text-sm">ผลลัพธ์</div>
              <div className="mt-2 grid grid-cols-2 gap-2">
                <div className="p-3 bg-white rounded shadow-sm">
                  <div className="text-xs text-slate-500">ปริมาตร (ลิตร)</div>
                  <div className="text-lg font-semibold">{displayed.volumeLiters.toFixed(2)} L</div>
                </div>
                <div className="p-3 bg-white rounded shadow-sm">
                  <div className="text-xs text-slate-500">ระดับน้ำมัน (cm)</div>
                  <div className="text-lg font-semibold">{displayed.levelCm.toFixed(2)} cm</div>
                </div>
                <div className="p-3 bg-white rounded shadow-sm">
                  <div className="text-xs text-slate-500">เปอร์เซ็นต์ความจุ</div>
                  <div className="text-lg font-semibold">{displayed.percent.toFixed(2)} %</div>
                </div>
                <div className="p-3 bg-white rounded shadow-sm">
                  <div className="text-xs text-slate-500">ความจุถังเต็ม</div>
                  <div className="text-lg font-semibold">{maxVolumeLiters.toFixed(2)} L</div>
                </div>
              </div>
            </div>
          </div>

          <div className="flex flex-col items-center">
            <div className="w-full flex justify-between items-center mb-3">
              <div className="text-sm text-slate-600">Preview</div>
              <div className="text-xs text-slate-500">การแสดงผลเป็นภาพคร่าว ๆ</div>
            </div>

            <div className="w-full bg-gradient-to-b from-slate-100 to-white rounded p-4 flex justify-center">
              <svg width="140" height={svgHeight} viewBox={`0 0 140 ${svgHeight}`} xmlns="http://www.w3.org/2000/svg">
                <defs>
                  <linearGradient id="g1" x1="0" x2="0" y1="0" y2="1">
                    <stop offset="0%" stopColor="#e2e8f0" />
                    <stop offset="100%" stopColor="#cbd5e1" />
                  </linearGradient>
                </defs>
                <ellipse cx="70" cy="18" rx="48" ry="14" fill="url(#g1)" stroke="#94a3b8" strokeWidth="1" />
                <rect x="22" y="18" width="96" height={svgHeight-36} fill="#f8fafc" stroke="#94a3b8" strokeWidth="1" rx="8" />
                <clipPath id="clipLiquid">
                  <rect x="22" y={18 + (svgHeight-36 - fillHeightPx)} width="96" height={fillHeightPx} rx="0" />
                </clipPath>
                <g clipPath="url(#clipLiquid)">
                  <rect x="22" y="18" width="96" height={svgHeight-36} fill="#0ea5a5" opacity="0.15" />
                  <ellipse cx="70" cy={18 + (svgHeight-36 - fillHeightPx)} rx="48" ry="14" fill="#0ea5a5" opacity="0.25" stroke="#0b7285" strokeWidth="0.5" />
                </g>
                <ellipse cx="70" cy={18 + (svgHeight-36)} rx="48" ry="14" fill="#e2e8f0" stroke="#94a3b8" strokeWidth="1" />
              </svg>
            </div>

            <div className="mt-4 w-full text-xs text-slate-500">
              Tip: ป้อนเป็นระดับหรือปริมาตร แล้วกด <span className="font-medium">คำนวณ</span>
            </div>
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById("oil-tank-app"));
    root.render(<OilTankChecker />);
  </script>
</body>
</html>
