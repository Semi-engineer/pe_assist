<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PE Ops Studio ‚Ä¢ Factory Simulation (Enhanced)</title>
  <link rel="stylesheet" href="./assets/factory-simulation-2d.css" />
  <link rel="icon" type="image/svg+xml" href="./assets/favicon.svg" />
  <script src="./assets/main.js" defer></script>
  <script defer src="./assets/js/ui.js"></script>
</head>
<body>
  <div id="site-header"></div>

  <!-- CAD-style Layout -->
  <div class="cad-layout">
    
    <!-- Header Bar -->
    <div class="cad-header">
      <h1 style="margin: 0; font-size: 1.2rem;">üè≠ Factory Simulation ‚Äî Enhanced</h1>
      <div class="mode-indicator" id="modePill">Select/Move</div>
    </div>
    
    <!-- Toolbar -->
    <div class="cad-toolbar">
      <div class="toolbar-group">
        <button class="btn" id="pauseBtn" type="button">‚è∏Ô∏è</button>
        <button class="btn" id="resetLayout" type="button">‚ôªÔ∏è</button>
      </div>
      <div class="toolbar-group">
        <label for="speed" style="color: white; font-size: 0.85rem;">Speed:</label>
        <input id="speed" type="range" min="1" max="8" step="1" value="1" style="width: 100px;"/>
        <span id="speedLabel" class="pill" style="background: #555; color: white;">1x</span>
      </div>
      <div class="toolbar-group">
        <label style="color: white; font-size: 0.85rem;">
          <input type="checkbox" id="gridToggle" checked> Grid
        </label>
      </div>
    </div>
    
    <!-- Main Area -->
    <div class="cad-main">
      
      <!-- Left Toolbox -->
      <div class="cad-toolbox">
        <div class="toolbox-section">
          <h3>üõ†Ô∏è Tools</h3>
          <div class="tool-grid">
            <button class="btn active" data-tool="select" type="button" style="font-size: 0.8rem;">üñ±Ô∏è Select</button>
            <button class="btn" data-tool="connect" type="button" style="font-size: 0.8rem;">üîó Connect</button>
            <button class="btn" data-tool="delete" type="button" style="font-size: 0.8rem;">üóëÔ∏è Delete</button>
          </div>
        </div>
        
        <div class="toolbox-section">
          <h3>‚ûï Add Nodes</h3>
          <div class="tool-grid">
            <button class="btn" data-add="source" type="button" style="font-size: 0.8rem;">üü© Source</button>
            <button class="btn" data-add="buffer" type="button" style="font-size: 0.8rem;">üü¶ Buffer</button>
            <button class="btn" data-add="machine" type="button" style="font-size: 0.8rem;">üü® Machine</button>
            <button class="btn" data-add="sink" type="button" style="font-size: 0.8rem;">üü• Sink</button>
          </div>
        </div>
        
        <div class="toolbox-section">
          <h3>üìä Legend</h3>
          <div class="legend" style="font-size: 0.8rem;">
            <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.25rem;">
              <div class="dot dot-part"></div><span>Part</span>
            </div>
            <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.25rem;">
              <div class="dot dot-busy"></div><span>Busy</span>
            </div>
            <div style="display: flex; align-items: center; gap: 0.5rem;">
              <div class="dot dot-sinked"></div><span>Sinked</span>
            </div>
          </div>
        </div>

        <div class="toolbox-section">
          <h3>üìà KPIs</h3>
          <div class="compact-kpi">
            <div class="card"><h3>Throughput</h3><div class="val" id="kpiThroughput">0 pcs</div></div>
            <div class="card"><h3>WIP</h3><div class="val" id="kpiWip">0</div></div>
            <div class="card"><h3>Efficiency</h3><div class="val" id="kpiEfficiency">0%</div></div>
            <div class="card"><h3>Total Cost</h3><div class="val" id="kpiCost">0 ‡∏ø</div></div>
            <div class="card"><h3>Cost/Unit</h3><div class="val" id="kpiUnitCost">0 ‡∏ø</div></div>
            <div class="card"><h3>Bottleneck</h3><div class="val" id="kpiBottle">-</div></div>
          </div>
        </div>
      </div>
      
      <!-- Central Canvas Area -->
      <div class="cad-canvas-area">
        <div class="panel canvasWrap" style="flex: 1; margin: 0; border: none; background: transparent;">
          <canvas id="view" style="width: 100%; height: 100%;"></canvas>
          <canvas id="mini" class="mini" width="180" height="110" title="Mini-map" style="position: absolute; top: 10px; right: 10px; border: 2px solid #333;"></canvas>
          <button class="btn reset-view" id="resetViewBtn" style="position: absolute; bottom: 10px; right: 10px;">Reset View</button>
        </div>
      </div>
      
      <!-- Right Properties Panel -->
      <div class="cad-properties">
        
        <!-- Inspector -->
        <div class="properties-section">
          <div class="properties-header">üîç Inspector</div>
          <div class="properties-content">
            <div class="inspect" id="inspector">
              <div class="hint" style="font-size: 0.85rem; color: #666;">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Node ‡∏´‡∏£‡∏∑‡∏≠ Part ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ñ‡πà‡∏≤‡πÑ‡∏î‡πâ</div>
            </div>
          </div>
        </div>

        <!-- Global Settings -->
        <div class="properties-section">
          <div class="properties-header">üìä Global Settings</div>
          <div class="properties-content">
            <div class="param-compact">
              <span class="param-label">Simulation Hours</span>
              <input type="number" class="param-input" id="simHours" value="8" min="1" max="24">
            </div>
            <div class="param-compact">
              <span class="param-label">Target Production</span>
              <input type="number" class="param-input" id="targetProd" value="100" min="1">
            </div>
            <div class="param-compact">
              <span class="param-label">Quality Target (%)</span>
              <input type="number" class="param-input" id="qualityTarget" value="95" min="50" max="100">
            </div>
          </div>
        </div>

        <!-- Material & Cost -->
        <div class="properties-section">
          <div class="properties-header">üí∞ Material & Cost</div>
          <div class="properties-content">
            <div class="param-compact">
              <span class="param-label">Raw Material (‡∏ø/unit)</span>
              <input type="number" class="param-input" id="materialCost" value="15.50" step="0.01" min="0">
            </div>
            <div class="param-compact">
              <span class="param-label">Setup Cost (‡∏ø/batch)</span>
              <input type="number" class="param-input" id="setupCost" value="500" min="0">
            </div>
            <div class="param-compact">
              <span class="param-label">Inventory Cost (%/day)</span>
              <input type="number" class="param-input" id="inventoryCost" value="0.5" step="0.1" min="0">
            </div>
            <div class="param-compact">
              <span class="param-label">Defect Cost (‡∏ø/unit)</span>
              <input type="number" class="param-input" id="defectCost" value="25" min="0">
            </div>
          </div>
        </div>

        <!-- Labor & Resources -->
        <div class="properties-section">
          <div class="properties-header">üë• Labor & Resources</div>
          <div class="properties-content">
            <div class="param-compact">
              <span class="param-label">Labor Rate (‡∏ø/hour)</span>
              <input type="number" class="param-input" id="laborRate" value="120" min="0">
            </div>
            <div class="param-compact">
              <span class="param-label">Operators/Machine</span>
              <input type="number" class="param-input" id="operatorsPerMachine" value="1" min="1" max="5">
            </div>
            <div class="param-compact">
              <span class="param-label">Overhead Rate (‡∏ø/hour)</span>
              <input type="number" class="param-input" id="overheadRate" value="80" min="0">
            </div>
          </div>
        </div>

        <!-- Machine Parameters -->
        <div class="properties-section">
          <div class="properties-header">‚öôÔ∏è Machine Parameters</div>
          <div class="properties-content">
            <div class="param-compact">
              <span class="param-label">Machine Cost (‡∏ø/hour)</span>
              <input type="number" class="param-input" id="machineCost" value="200" min="0">
            </div>
            <div class="param-compact">
              <span class="param-label">Maintenance Rate (%)</span>
              <input type="number" class="param-input" id="maintenanceRate" value="2" step="0.1" min="0" max="10">
            </div>
            <div class="param-compact">
              <span class="param-label">Energy Cost (‡∏ø/hour)</span>
              <input type="number" class="param-input" id="energyCost" value="45" min="0">
            </div>
            <div class="param-compact">
              <span class="param-label">Utilization Target (%)</span>
              <input type="number" class="param-input" id="utilizationTarget" value="85" min="50" max="100">
            </div>
          </div>
        </div>

        <!-- Quality & Reliability -->
        <div class="properties-section">
          <div class="properties-header">‚úÖ Quality & Reliability</div>
          <div class="properties-content">
            <div class="param-compact">
              <span class="param-label">Defect Rate (%)</span>
              <input type="number" class="param-input" id="defectRate" value="2.5" step="0.1" min="0" max="20">
            </div>
            <div class="param-compact">
              <span class="param-label">Rework Rate (%)</span>
              <input type="number" class="param-input" id="reworkRate" value="1.2" step="0.1" min="0" max="10">
            </div>
            <div class="param-compact">
              <span class="param-label">Machine Downtime (%)</span>
              <input type="number" class="param-input" id="downtimeRate" value="5" step="0.1" min="0" max="20">
            </div>
          </div>
        </div>

        <!-- Buffer & Flow -->
        <div class="properties-section">
          <div class="properties-header">üì¶ Buffer & Flow</div>
          <div class="properties-content">
            <div class="param-compact">
              <span class="param-label">Buffer Capacity</span>
              <input type="number" class="param-input" id="bufferCapacity" value="20" min="1" max="1000">
            </div>
            <div class="param-compact">
              <span class="param-label">Transport Speed (m/min)</span>
              <input type="number" class="param-input" id="transportSpeed" value="30" min="1" max="200">
            </div>
            <div class="param-compact">
              <span class="param-label">Batch Size</span>
              <input type="number" class="param-input" id="batchSize" value="10" min="1" max="100">
            </div>
          </div>
        </div>

        <!-- Apply Button -->
        <button class="btn primary" id="applyParams" style="width: 100%; margin: 1rem 0;">üîÑ Apply Parameters</button>

        <!-- Cost Breakdown -->
        <div class="properties-section">
          <div class="properties-header">üí∞ Cost Breakdown</div>
          <div class="properties-content">
            <div style="font-size: 0.85rem;">
              <div class="cost-row" style="display: flex; justify-content: space-between; margin-bottom: 0.25rem;">
                <span>Material:</span>
                <span id="costMaterial">0 ‡∏ø</span>
              </div>
              <div class="cost-row" style="display: flex; justify-content: space-between; margin-bottom: 0.25rem;">
                <span>Labor:</span>
                <span id="costLabor">0 ‡∏ø</span>
              </div>
              <div class="cost-row" style="display: flex; justify-content: space-between; margin-bottom: 0.25rem;">
                <span>Machine:</span>
                <span id="costMachine">0 ‡∏ø</span>
              </div>
              <div class="cost-row" style="display: flex; justify-content: space-between; margin-bottom: 0.25rem;">
                <span>Overhead:</span>
                <span id="costOverhead">0 ‡∏ø</span>
              </div>
              <hr style="margin: 0.5rem 0;">
              <div class="cost-row cost-total" style="display: flex; justify-content: space-between; font-weight: bold;">
                <span>Total:</span>
                <span id="costTotal">0 ‡∏ø</span>
              </div>
            </div>
          </div>
        </div>

      </div>
      
    </div>
    
    <!-- Status Bar -->
    <div class="cad-status-bar">
      <div>
        Nodes: <span id="statNodes">0</span> ‚Ä¢ 
        Edges: <span id="statEdges">0</span> ‚Ä¢ 
        Parts: <span id="statParts">0</span>
      </div>
      <div>Tip: ‡πÉ‡∏ä‡πâ‡πÇ‡∏´‡∏°‡∏î üîó Connect ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ï‡πâ‡∏ô‡∏ó‡∏≤‡∏á ‚Üí ‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏≥ Flow</div>
    </div>
    
  </div>

  <script src="./assets/js/factory-simulation-2d.js"></script>
  <div id="site-footer"></div>
</body>
</html>